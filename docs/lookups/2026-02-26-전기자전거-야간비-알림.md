# 전기자전거 출퇴근 시 야간 비 예보 알림

## 문제 정의
아침에 전기자전거를 타고 출근한 경우, 저녁에 타고 귀가한 뒤 야간~새벽~다음날 비가 오는지 확인하여 자전거가 비에 맞지 않도록 조치해야 한다. 아침에 출근 수단을 선택하면, 전기자전거를 탄 날에만 저녁 9~10시에 날씨 알림을 받고 싶다.

## 분석
- 사람 개입: A) 필요 없음 (아침 출근 수단 선택만 필요, 이후는 자동)
- 반복 주기: B) 매일 정기적 스케줄
- AI 추론: A) 불필요 — 단순 조건 분기 자동화
- 외부 서비스: B) 1-2개 서비스 (날씨 API + 텔레그램)

## 추천
**n8n 워크플로우**

매일 아침 텔레그램으로 출근 수단을 묻고, 전기자전거 선택 시 저녁 9~10시에 날씨 API를 조회하여 비 예보가 있으면 텔레그램으로 알림을 보내는 자동화에 n8n이 가장 적합하다. 텔레그램 봇의 인라인 버튼으로 아침 상호작용을 처리하고, 날씨 API 연동과 조건부 알림까지 하나의 워크플로우로 구성할 수 있다.

### 다른 방식이 안 되는 이유
- launchd + 셸 스크립트: 텔레그램 상호작용(버튼 선택)과 멀티서비스 연동을 셸 스크립트로 처리하기엔 복잡하고 유지보수가 어려움
- Apple Shortcuts: 서버 측에서 스케줄 트리거와 텔레그램 봇 상호작용을 처리해야 하므로 디바이스 기반 Shortcuts로는 한계가 있음
- Raycast 확장: 자동 스케줄 실행이 핵심인데, Raycast는 사용자가 직접 호출하는 방식이라 맞지 않음
- Claude Code 스킬: AI 추론이 불필요한 단순 조건 분기 자동화이므로 과도함

## 구현 결과

### 배포된 워크플로우

| 워크플로우 | ID | 노드 수 | 역할 |
|---|---|---|---|
| 전기자전거 출근 확인 | `qIOmzCkxNOqHwIPz` | 2 | 평일 8AM 텔레그램 인라인 키보드로 출근 수단 질문 |
| 전기자전거 날씨 알림 | `qygtdIcmqQtXip9c` | 10 | 콜백 수신 → Wait(21:00) → Open-Meteo 강수 조회 → 알림 |

### 아키텍처

- **Workflow 1** (Schedule Trigger): 평일 8AM → Telegram 인라인 키보드 ("전기자전거 / 기타")
- **Workflow 2** (Telegram Trigger): 콜백 수신 → IF(ebike) → 확인 응답 → Wait(21:00) → Open-Meteo API → 강수 파싱 → IF(비) → 알림
- Wait 노드로 상태 공유 없이 단일 실행 흐름 유지

### 수동 설정 필요 항목
- n8n Telegram API Credential 연결
- n8n Variables: `TELEGRAM_CHAT_ID`, `LOCATION_LAT`, `LOCATION_LON`
- 워크플로우 활성화

### 참고
- 날씨 API: Open-Meteo (무료, 키 불필요)
- 강수 판단: 21:00~익일 09:00, 강수확률 30% 이상 또는 강수량 > 0mm
- 플랜 문서: `docs/plans/2026-02-26-전기자전거-야간비-알림.md`
