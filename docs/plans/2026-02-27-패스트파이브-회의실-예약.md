# íŒ¨ìŠ¤íŠ¸íŒŒì´ë¸Œ íšŒì˜ì‹¤ ë””ìŠ¤ì½”ë“œ ì˜ˆì•½ ë´‡ êµ¬í˜„ ê³„íš

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** ë””ìŠ¤ì½”ë“œì—ì„œ ìì—°ì–´ë¡œ íŒ¨ìŠ¤íŠ¸íŒŒì´ë¸Œ íšŒì˜ì‹¤ì„ ì˜ˆì•½í•˜ê³ , ê°€ìš© ì—¬ë¶€ í”¼ë“œë°±ì„ ë°›ëŠ” n8n ì›Œí¬í”Œë¡œìš°ë¥¼ ë§Œë“ ë‹¤.

**Architecture:** Discord ë´‡(ì…ë ¥) â†’ n8n Webhook â†’ Claude LLM(ìì—°ì–´ íŒŒì‹±) â†’ FastFive REST API(ë¡œê·¸ì¸/ì¡°íšŒ/ì˜ˆì•½) â†’ Discord ì›¹í›…(ê²°ê³¼ ì „ì†¡). ê¸°ì¡´ "ê°œì¸ ì¼ì • ë“±ë¡" ì›Œí¬í”Œë¡œìš°ì˜ Claude Proxy + Whisper STT íŒ¨í„´ì„ ì¬í™œìš©í•œë‹¤.

**Tech Stack:** n8n, Discord.js (ë´‡ ë¸Œë¦¿ì§€), Claude API Proxy (`http://10.0.0.1:3456`), Whisper STT (`http://host.docker.internal:8100`), FastFive REST API (`https://api.fastfive.co.kr`)

---

## ì‚¬ì „ ì§€ì‹: FastFive API

### ì¸ì¦
- POST `https://api.fastfive.co.kr/auth/signin` â€” `{ application: "web", email, password }`
- ì¿ í‚¤ ê¸°ë°˜ ì„¸ì…˜. ëª¨ë“  ìš”ì²­ì— `withCredentials: true`, í—¤ë” `X-Application: web`
- GET `/mobile/user/profile` â€” ì„¸ì…˜ ìœ íš¨ì„± í™•ì¸

### í•µì‹¬ ì˜ˆì•½ API
| ë©”ì„œë“œ | ê²½ë¡œ | ìš©ë„ |
|--------|------|------|
| GET | `/mobile/spaces/reservable` | ì˜ˆì•½ ê°€ëŠ¥í•œ ê³µê°„ ëª©ë¡ (spaceCategoryId, branchId, ë‚ ì§œ/ì‹œê°„ íŒŒë¼ë¯¸í„°) |
| POST | `/mobile/spaceReservations/reservable` | íŠ¹ì • ê³µê°„/ì‹œê°„ ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ |
| POST | `/mobile/spaceReservations` | ì˜ˆì•½ ìƒì„± |
| GET | `/mobile/spaceReservations` | ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ |
| DELETE | `/mobile/spaceReservations/{id}` | ì˜ˆì•½ ì·¨ì†Œ |
| GET | `/mobile/memberGroups/{id}/branches` | ê·¸ë£¹ì˜ ì§€ì  ëª©ë¡ |
| GET | `/mobile/MemberGroups/{id}/credits` | ê°€ìš© í¬ë ˆë”§ ì¡°íšŒ |

### ê³µê°„ ì¹´í…Œê³ ë¦¬
- meeting-room: spaceCategoryId **7** (= URL `/reserve/7`)

### ê¸°ì¡´ ì¸í”„ë¼ (ì¬í™œìš©)
- Claude Proxy: `http://10.0.0.1:3456/v1/chat/completions` (model: `claude-sonnet-4-6`)
- Whisper STT: `http://host.docker.internal:8100/v1/audio/transcriptions`
- ê¸°ì¡´ "ê°œì¸ ì¼ì • ë“±ë¡" ì›Œí¬í”Œë¡œìš° (`GHtwwMEAXRRTonI7`) íŒ¨í„´ ì°¸ì¡°

---

## Task 0: ì‚¬ìš©ì ì…ë ¥ í•„ìš” â€” FastFive ë¡œê·¸ì¸ ì •ë³´ + Discord ë´‡ í† í°

ì´ ì‘ì—…ì„ ì‹œì‘í•˜ê¸° ì „ì— ì‚¬ìš©ìì—ê²Œ ì•„ë˜ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤:

1. **íŒ¨ìŠ¤íŠ¸íŒŒì´ë¸Œ ë¡œê·¸ì¸ ì •ë³´** â€” ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ (n8n credentialë¡œ ì €ì¥)
2. **íŒ¨ìŠ¤íŠ¸íŒŒì´ë¸Œ memberGroupId** â€” ì‹ ë…¼í˜„ 2í˜¸ì ì˜ ê·¸ë£¹ ID (ë¡œê·¸ì¸ í›„ `/mobile/user/memberGroups`ë¡œ í™•ì¸ ê°€ëŠ¥)
3. **íŒ¨ìŠ¤íŠ¸íŒŒì´ë¸Œ branchId** â€” ì‹ ë…¼í˜„ 2í˜¸ì ì˜ ì§€ì  ID (ë¡œê·¸ì¸ í›„ í™•ì¸)
4. **Discord ë´‡ í† í°** â€” [Discord Developer Portal](https://discord.com/developers/applications)ì—ì„œ ìƒì„±
5. **Discord ì±„ë„ ID** â€” ì˜ˆì•½ ë´‡ì´ ë™ì‘í•  ì±„ë„
6. **Discord ì›¹í›… URL** â€” í•´ë‹¹ ì±„ë„ì— ìƒì„±í•œ ì›¹í›… (n8nì´ ê²°ê³¼ ì „ì†¡ì— ì‚¬ìš©)

---

## Task 1: FastFive API ì¸ì¦ ê²€ì¦

FastFive APIì— ë¡œê·¸ì¸í•˜ê³  ì„¸ì…˜ì´ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.

**Step 1: n8nì—ì„œ ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì›Œí¬í”Œë¡œìš° ìƒì„±**

n8n MCPë¡œ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ë§Œë“ ë‹¤:
- Manual Trigger â†’ HTTP Request (ë¡œê·¸ì¸) â†’ HTTP Request (í”„ë¡œí•„ ì¡°íšŒ) â†’ HTTP Request (ì§€ì  ëª©ë¡)

```
ë…¸ë“œ 1: Manual Trigger
ë…¸ë“œ 2: FastFive Login
  - POST https://api.fastfive.co.kr/auth/signin
  - Body: { "application": "web", "email": "<ì‚¬ìš©ì ì´ë©”ì¼>", "password": "<ë¹„ë°€ë²ˆí˜¸>" }
  - Headers: X-Application: web
  - Options: Always Output Data = true
ë…¸ë“œ 3: Get Profile
  - GET https://api.fastfive.co.kr/mobile/user/profile
  - Headers: X-Application: web
ë…¸ë“œ 4: Get Member Groups
  - GET https://api.fastfive.co.kr/mobile/user/memberGroups
  - Headers: X-Application: web
```

**Step 2: ì‹¤í–‰í•˜ì—¬ memberGroupId, branchId í™•ì¸**

Run: `n8n_test_workflow` (Manual Trigger)
Expected: ë¡œê·¸ì¸ ì„±ê³µ, í”„ë¡œí•„ ë°˜í™˜, memberGroupsì—ì„œ ì‹ ë…¼í˜„ 2í˜¸ì ì˜ memberGroupIdì™€ branchId í™•ì¸

**Step 3: ì˜ˆì•½ ê°€ëŠ¥ ê³µê°„ ì¡°íšŒ í…ŒìŠ¤íŠ¸**

```
ë…¸ë“œ 5: Get Reservable Spaces
  - GET https://api.fastfive.co.kr/mobile/spaces/reservable
  - Query: spaceCategoryId=7, branchId=<í™•ì¸ëœ ID>, date=<ì˜¤ëŠ˜>, startTime=<ì˜ˆì‹œ>, endTime=<ì˜ˆì‹œ>
  - Headers: X-Application: web
```

Expected: íšŒì˜ì‹¤ ëª©ë¡ ë°˜í™˜ (ì´ë¦„, ìˆ˜ìš©ì¸ì›, ì¸µ, ì‹œì„¤ íƒœê·¸ ë“±)

**Step 4: í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ì›Œí¬í”Œë¡œìš° ì‚­ì œ ë˜ëŠ” ë³´ê´€**

---

## Task 2: Discord ë´‡ ë¸Œë¦¿ì§€ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

ë””ìŠ¤ì½”ë“œ ë©”ì‹œì§€ë¥¼ n8n ì›¹í›…ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” ê²½ëŸ‰ ë´‡ì„ ì‘ì„±í•œë‹¤.

**Files:**
- Create: `discord-bot/index.js`
- Create: `discord-bot/package.json`
- Create: `discord-bot/.env.example`

**Step 1: package.json ì‘ì„±**

```json
{
  "name": "fastfive-reservation-bot",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node index.js"
  },
  "dependencies": {
    "discord.js": "^14.16.0",
    "dotenv": "^16.4.0"
  }
}
```

**Step 2: .env.example ì‘ì„±**

```
DISCORD_TOKEN=your_discord_bot_token
DISCORD_CHANNEL_ID=your_channel_id
N8N_WEBHOOK_URL=http://your-n8n-host:5678/webhook/fastfive-reserve
```

**Step 3: index.js ì‘ì„±**

```javascript
import 'dotenv/config';
import { Client, GatewayIntentBits } from 'discord.js';

const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent,
  ],
});

const CHANNEL_ID = process.env.DISCORD_CHANNEL_ID;
const WEBHOOK_URL = process.env.N8N_WEBHOOK_URL;

client.on('ready', () => {
  console.log(`Bot ready: ${client.user.tag}`);
});

client.on('messageCreate', async (message) => {
  if (message.author.bot) return;
  if (message.channelId !== CHANNEL_ID) return;

  // í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ë˜ëŠ” ìŒì„± ì²¨ë¶€íŒŒì¼ ì²˜ë¦¬
  const payload = {
    userId: message.author.id,
    username: message.author.username,
    channelId: message.channelId,
    messageId: message.id,
  };

  // ìŒì„± ì²¨ë¶€íŒŒì¼ í™•ì¸
  const audioAttachment = message.attachments.find(
    (a) => a.contentType?.startsWith('audio/')
  );

  if (audioAttachment) {
    payload.type = 'voice';
    payload.audioUrl = audioAttachment.url;
  } else if (message.content.trim()) {
    payload.type = 'text';
    payload.text = message.content.trim();
  } else {
    return; // ë¹ˆ ë©”ì‹œì§€ ë¬´ì‹œ
  }

  try {
    await message.react('â³');
    const res = await fetch(WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });
    const result = await res.json();

    await message.reply(result.message || 'ì²˜ë¦¬ ì™„ë£Œ');
    await message.reactions.cache.get('â³')?.remove();
  } catch (err) {
    console.error('Webhook error:', err);
    await message.reply('âŒ ì˜ˆì•½ ì‹œìŠ¤í…œì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
});

client.login(process.env.DISCORD_TOKEN);
```

**Step 4: ì˜ì¡´ì„± ì„¤ì¹˜ ë° ë´‡ ì‹¤í–‰ í…ŒìŠ¤íŠ¸**

Run: `cd discord-bot && npm install && node index.js`
Expected: `Bot ready: <ë´‡ì´ë¦„>#<ë²ˆí˜¸>`

**Step 5: ì»¤ë°‹**

```bash
git add discord-bot/
git commit -m "feat: Discord ë´‡ ë¸Œë¦¿ì§€ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±"
```

---

## Task 3: n8n ì›Œí¬í”Œë¡œìš° â€” ë¼ˆëŒ€ ìƒì„±

Discord ì›¹í›… ìˆ˜ì‹  â†’ ì‘ë‹µ ë°˜í™˜ê¹Œì§€ì˜ ê¸°ë³¸ ê³¨ê²©ì„ ë§Œë“ ë‹¤.

**Step 1: ì›Œí¬í”Œë¡œìš° ìƒì„± (n8n MCP)**

`n8n_create_workflow`ë¡œ ì•„ë˜ êµ¬ì¡°ì˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•œë‹¤:

```
Webhook Trigger (POST /webhook/fastfive-reserve)
  â†’ Is Voice?
    â†’ [true] Download Audio â†’ Whisper STT â†’ Prepare Text â†’ Claude Proxy
    â†’ [false] Claude Proxy
  â†’ Parse Reservation JSON
  â†’ FastFive Login
  â†’ Check Availability
  â†’ Has Available Room?
    â†’ [true] Create Reservation â†’ Format Success Response
    â†’ [false] Format Unavailable Response
  â†’ Webhook Response
```

ë…¸ë“œ êµ¬ì„±:
1. **Webhook** â€” path: `fastfive-reserve`, method: POST, responseMode: `lastNode`
2. **Is Voice?** â€” `{{ $json.type === 'voice' ? 'yes' : 'no' }}` === 'yes'
3. **Download Audio** â€” GET `{{ $json.audioUrl }}`, response format: file
4. **Whisper STT** â€” POST `http://host.docker.internal:8100/v1/audio/transcriptions`
5. **Prepare Text** â€” ìŒì„±â†’í…ìŠ¤íŠ¸ ë³€í™˜, ì›ë³¸ payload ë³‘í•©
6. **Claude Proxy** â€” POST `http://10.0.0.1:3456/v1/chat/completions`
7. **Parse Reservation JSON** â€” Code ë…¸ë“œ, LLM ì‘ë‹µì—ì„œ JSON ì¶”ì¶œ
8. **FastFive Login** â€” POST `/auth/signin`
9. **Check Availability** â€” GET `/mobile/spaces/reservable`
10. **Has Available Room?** â€” IF ë…¸ë“œ
11. **Create Reservation** â€” POST `/mobile/spaceReservations`
12. **Format Success/Unavailable Response** â€” Code ë…¸ë“œ
13. **Webhook Response** â€” Respond to Webhook ë…¸ë“œ

**Step 2: ì›Œí¬í”Œë¡œìš° ê²€ì¦**

Run: `n8n_validate_workflow`
Expected: ê²€ì¦ í†µê³¼

**Step 3: ì»¤ë°‹ (docsì— ì›Œí¬í”Œë¡œìš° ID ê¸°ë¡)**

---

## Task 4: Claude Proxy â€” ì˜ˆì•½ íŒŒì‹± í”„ë¡¬í”„íŠ¸

ìì—°ì–´ ë©”ì‹œì§€ì—ì„œ ì˜ˆì•½ ì •ë³´(ë‚ ì§œ, ì‹œê°„, ì¸ì›)ë¥¼ ì¶”ì¶œí•˜ëŠ” LLM í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•œë‹¤.

**Step 1: Claude Proxy ë…¸ë“œ ì„¤ì •**

```
POST http://10.0.0.1:3456/v1/chat/completions
Body:
{
  model: "claude-sonnet-4-6",
  messages: [
    {
      role: "system",
      content: "ë‹¹ì‹ ì€ íšŒì˜ì‹¤ ì˜ˆì•½ íŒŒì‹± ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìì—°ì–´ ë©”ì‹œì§€ì—ì„œ ì˜ˆì•½ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì„¸ìš”.\n\ní˜„ì¬ ë‚ ì§œ: <$now KST>\ní˜„ì¬ ìš”ì¼: <$now ìš”ì¼>\ní˜„ì¬ ì‹œê°„: <$now KST HH:mm>\n\në°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:\n{\n  \"date\": \"YYYY-MM-DD\",\n  \"startTime\": \"HH:mm\",\n  \"endTime\": \"HH:mm\",\n  \"capacity\": <ìˆ«ì ë˜ëŠ” null>,\n  \"error\": false\n}\n\nê·œì¹™:\n- 30ë¶„ ë‹¨ìœ„ë¡œ ë°˜ì˜¬ë¦¼ (ì˜ˆ: 2:40 â†’ 3:00, 2:10 â†’ 2:00)\n- ì¢…ë£Œ ì‹œê°„ ì—†ìœ¼ë©´ ì‹œì‘ + 1ì‹œê°„\n- ì¸ì› ì–¸ê¸‰ ì—†ìœ¼ë©´ capacity: null\n- í•´ì„ ë¶ˆê°€ëŠ¥í•˜ë©´ { \"error\": true, \"message\": \"ì´í•´í•  ìˆ˜ ì—†ëŠ” ìš”ì²­ì…ë‹ˆë‹¤\" }"
    },
    { role: "user", content: <ì‚¬ìš©ì í…ìŠ¤íŠ¸> }
  ],
  max_tokens: 300
}
```

**Step 2: Parse Reservation JSON ë…¸ë“œ êµ¬í˜„**

```javascript
const aiResponse = $input.first().json.choices[0].message.content || '';
const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);

if (!jsonMatch) {
  return [{ json: { error: true, message: 'âŒ ì˜ˆì•½ ì •ë³´ë¥¼ ì¸ì‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì˜ˆì‹œ: "ë‚´ì¼ ì˜¤í›„ 2ì‹œ íšŒì˜ì‹¤ ì˜ˆì•½í•´ì¤˜"' } }];
}

const parsed = JSON.parse(jsonMatch[0]);
if (parsed.error) {
  return [{ json: parsed }];
}

// ISO í˜•ì‹ ë³€í™˜
parsed.startISO = parsed.date + 'T' + parsed.startTime + ':00+09:00';
parsed.endISO = parsed.date + 'T' + parsed.endTime + ':00+09:00';

return [{ json: { ...parsed, ...$('Webhook').item.json } }];
```

**Step 3: í…ŒìŠ¤íŠ¸**

n8n webhookì— í…ŒìŠ¤íŠ¸ ìš”ì²­:
```json
{ "type": "text", "text": "ë‚´ì¼ ì˜¤í›„ 2ì‹œì— 4ëª… íšŒì˜ì‹¤ ì˜ˆì•½í•´ì¤˜" }
```
Expected: `{ "date": "2026-02-28", "startTime": "14:00", "endTime": "15:00", "capacity": 4, "error": false }`

**Step 4: ì»¤ë°‹**

---

## Task 5: FastFive API ì²´ì¸ â€” ë¡œê·¸ì¸ â†’ ì¡°íšŒ â†’ ì˜ˆì•½

n8n ì›Œí¬í”Œë¡œìš°ì— FastFive API í˜¸ì¶œ ì²´ì¸ì„ êµ¬í˜„í•œë‹¤.

**Step 1: FastFive Login ë…¸ë“œ**

```
POST https://api.fastfive.co.kr/auth/signin
Headers: X-Application: web
Body: { "application": "web", "email": "<credential>", "password": "<credential>" }
```

Note: n8nì˜ HTTP Request ë…¸ë“œì—ì„œ ì¿ í‚¤ë¥¼ ìë™ìœ¼ë¡œ ì „íŒŒí•˜ë ¤ë©´ `"batching"` ì˜µì…˜ ë˜ëŠ” Code ë…¸ë“œì—ì„œ Set-Cookieë¥¼ ìˆ˜ë™ íŒŒì‹±í•´ì•¼ í•  ìˆ˜ ìˆë‹¤. ëŒ€ì•ˆìœ¼ë¡œ n8nì˜ HTTP Request ë…¸ë“œê°€ ì¿ í‚¤ë¥¼ ìë™ ì „íŒŒí•˜ì§€ ì•ŠëŠ” ê²½ìš°, ë¡œê·¸ì¸ ì‘ë‹µì˜ Set-Cookie í—¤ë”ë¥¼ ì¶”ì¶œí•˜ì—¬ ì´í›„ ìš”ì²­ì— Cookie í—¤ë”ë¡œ ì „ë‹¬í•˜ëŠ” Code ë…¸ë“œê°€ í•„ìš”í•˜ë‹¤.

**Step 2: Extract Session Cookie ë…¸ë“œ (Code)**

```javascript
const headers = $input.first().json.$response?.headers || {};
const setCookie = headers['set-cookie'];
// ì¿ í‚¤ ë¬¸ìì—´ ì¶”ì¶œ
const cookies = Array.isArray(setCookie)
  ? setCookie.map(c => c.split(';')[0]).join('; ')
  : (setCookie || '').split(';')[0];
return [{ json: { ...$input.first().json, sessionCookie: cookies } }];
```

**Step 3: Check Availability ë…¸ë“œ**

```
GET https://api.fastfive.co.kr/mobile/spaces/reservable
Headers:
  X-Application: web
  Cookie: {{ $json.sessionCookie }}
Query:
  spaceCategoryId: 7
  branchId: <ì‹ ë…¼í˜„ 2í˜¸ì  branchId>
  date: {{ $('Parse Reservation JSON').item.json.date }}
  startTime: {{ $('Parse Reservation JSON').item.json.startISO }}
  endTime: {{ $('Parse Reservation JSON').item.json.endISO }}
```

**Step 4: Filter Available Rooms (Code)**

```javascript
const spaces = $input.first().json; // API ì‘ë‹µ
const capacity = $('Parse Reservation JSON').item.json.capacity;
let available = Array.isArray(spaces) ? spaces : (spaces.data || []);

// ì¸ì› í•„í„°ë§ (capacityê°€ ì§€ì •ëœ ê²½ìš°)
if (capacity) {
  available = available.filter(s => s.capacity >= capacity);
}

if (available.length === 0) {
  return [{ json: { hasRoom: false, message: 'í•´ë‹¹ ì‹œê°„ì— ì˜ˆì•½ ê°€ëŠ¥í•œ íšŒì˜ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.' } }];
}

// ê°€ì¥ ì í•©í•œ ë°© ì„ íƒ (ìˆ˜ìš©ì¸ì›ì´ ê°€ì¥ ì‘ìœ¼ë©´ì„œ ì¡°ê±´ ì¶©ì¡±)
available.sort((a, b) => a.capacity - b.capacity);
const selected = available[0];

return [{ json: {
  hasRoom: true,
  spaceId: selected.id,
  spaceName: selected.name,
  capacity: selected.capacity,
  floorName: selected.floorName
} }];
```

**Step 5: Has Available Room? (IF ë…¸ë“œ)**

ì¡°ê±´: `{{ $json.hasRoom }}` equals `true`

**Step 6: Create Reservation ë…¸ë“œ**

```
POST https://api.fastfive.co.kr/mobile/spaceReservations
Headers:
  X-Application: web
  Cookie: {{ $('Extract Session Cookie').item.json.sessionCookie }}
Body: {
  "spaceId": {{ $json.spaceId }},
  "startTime": "{{ $('Parse Reservation JSON').item.json.startISO }}",
  "endTime": "{{ $('Parse Reservation JSON').item.json.endISO }}",
  "memberGroupId": <ì‹ ë…¼í˜„ 2í˜¸ì  memberGroupId>
}
```

Note: ì •í™•í•œ request body í˜•ì‹ì€ Task 1ì˜ API í…ŒìŠ¤íŠ¸ì—ì„œ í™•ì¸ì´ í•„ìš”í•˜ë‹¤. ìœ„ëŠ” ì¶”ì •ëœ í˜•ì‹ì´ë©°, ì‹¤ì œ í˜¸ì¶œ ì‹œ ì¶”ê°€ í•„ë“œ(name, paymentMode ë“±)ê°€ í•„ìš”í•  ìˆ˜ ìˆë‹¤.

**Step 7: ì»¤ë°‹**

---

## Task 6: ì‘ë‹µ í¬ë§¤íŒ… ë° Webhook Response

ì˜ˆì•½ ê²°ê³¼ë¥¼ ì‚¬ìš©ìì—ê²Œ ì•Œê¸° ì‰½ê²Œ ì „ë‹¬í•œë‹¤.

**Step 1: Format Success Response (Code)**

```javascript
const reservation = $input.first().json;
const parsed = $('Parse Reservation JSON').item.json;
const space = $('Filter Available Rooms').item.json;

const msg = [
  'âœ… íšŒì˜ì‹¤ ì˜ˆì•½ ì™„ë£Œ!',
  '',
  `ğŸ“ ${space.spaceName} (${space.floorName}, ${space.capacity}ì¸)`,
  `ğŸ“… ${parsed.date}`,
  `ğŸ•’ ${parsed.startTime} - ${parsed.endTime}`,
].join('\n');

return [{ json: { message: msg } }];
```

**Step 2: Format Unavailable Response (Code)**

```javascript
const parsed = $('Parse Reservation JSON').item.json;
const msg = [
  'âŒ ì˜ˆì•½ ê°€ëŠ¥í•œ íšŒì˜ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.',
  '',
  `ğŸ“… ${parsed.date} ${parsed.startTime} - ${parsed.endTime}`,
  parsed.capacity ? `ğŸ‘¥ ${parsed.capacity}ì¸ ì´ìƒ` : '',
  '',
  'ë‹¤ë¥¸ ì‹œê°„ì„ ì‹œë„í•´ë³´ì„¸ìš”.',
].filter(Boolean).join('\n');

return [{ json: { message: msg } }];
```

**Step 3: Webhook Response ë…¸ë“œ**

Respond to Webhook ë…¸ë“œë¡œ `{{ $json }}` ë°˜í™˜ (JSON).

**Step 4: ì»¤ë°‹**

---

## Task 7: ìŒì„± ì…ë ¥ ê²½ë¡œ (Whisper STT)

ê¸°ì¡´ "ê°œì¸ ì¼ì • ë“±ë¡" ì›Œí¬í”Œë¡œìš°ì˜ ìŒì„± ì²˜ë¦¬ íŒ¨í„´ì„ ì¬í™œìš©í•œë‹¤.

**Step 1: Download Audio ë…¸ë“œ**

```
GET {{ $json.audioUrl }}
Options: response format = file
```

**Step 2: Whisper STT ë…¸ë“œ**

```
POST http://host.docker.internal:8100/v1/audio/transcriptions
Content-Type: multipart/form-data
Body:
  file: (binary data from Download Audio)
  model: Systran/faster-whisper-small
```

**Step 3: Prepare Text ë…¸ë“œ (Code)**

```javascript
const transcribedText = $input.first().json.text || '';
if (!transcribedText.trim()) {
  return [{ json: { error: true, message: 'ğŸ¤ ìŒì„±ì„ ì¸ì‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' } }];
}
return [{
  json: {
    ...$('Webhook').item.json,
    type: 'text',
    text: transcribedText
  }
}];
```

**Step 4: ì»¤ë°‹**

---

## Task 8: ì—ëŸ¬ í•¸ë“¤ë§ ê²½ë¡œ

íŒŒì‹± ì‹¤íŒ¨, API ì˜¤ë¥˜, ë¡œê·¸ì¸ ì‹¤íŒ¨ ë“±ì˜ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•œë‹¤.

**Step 1: Parse ì—ëŸ¬ ë¶„ê¸°**

Parse Reservation JSONì—ì„œ `error: true`ë©´ ë°”ë¡œ Webhook Responseë¡œ ë³´ë‚´ëŠ” ê²½ë¡œ ì¶”ê°€.

**Step 2: FastFive Login ì‹¤íŒ¨ ì²˜ë¦¬**

Login ë…¸ë“œì— `continueOnFail: true` ì„¤ì •. ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜:
```
"âŒ íŒ¨ìŠ¤íŠ¸íŒŒì´ë¸Œ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”."
```

**Step 3: Reservation ìƒì„± ì‹¤íŒ¨ ì²˜ë¦¬**

Create Reservation ë…¸ë“œì— `continueOnFail: true` ì„¤ì •. ì‹¤íŒ¨ ì‹œ:
```
"âŒ ì˜ˆì•½ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ì´ê±°ë‚˜ í¬ë ˆë”§ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
```

**Step 4: ì»¤ë°‹**

---

## Task 9: í†µí•© í…ŒìŠ¤íŠ¸ ë° í™œì„±í™”

**Step 1: n8n ì›Œí¬í”Œë¡œìš° ê²€ì¦**

Run: `n8n_validate_workflow`
Expected: í†µê³¼

**Step 2: ìˆ˜ë™ ì›¹í›… í…ŒìŠ¤íŠ¸**

```bash
curl -X POST http://<n8n-host>:5678/webhook-test/fastfive-reserve \
  -H "Content-Type: application/json" \
  -d '{"type":"text","text":"ë‚´ì¼ ì˜¤í›„ 3ì‹œ 4ëª… íšŒì˜ì‹¤","userId":"test","channelId":"test"}'
```

Expected: ì˜ˆì•½ ì„±ê³µ ë˜ëŠ” ê°€ìš© ì—¬ë¶€ í”¼ë“œë°± ë©”ì‹œì§€ ë°˜í™˜

**Step 3: Discord ë´‡ ì—°ë™ í…ŒìŠ¤íŠ¸**

1. Discord ë´‡ ì‹¤í–‰
2. ì§€ì • ì±„ë„ì—ì„œ "ë‚´ì¼ ì˜¤í›„ 3ì‹œ íšŒì˜ì‹¤ ì˜ˆì•½í•´ì¤˜" ë©”ì‹œì§€ ì „ì†¡
3. ë´‡ì´ â³ ë°˜ì‘ í›„ ì˜ˆì•½ ê²°ê³¼ ì‘ë‹µ í™•ì¸

**Step 4: ì›Œí¬í”Œë¡œìš° í™œì„±í™”**

```
n8n MCP: activateWorkflow
```

**Step 5: Discord ë´‡ì„ ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ë¡œ ë“±ë¡**

pm2 ë˜ëŠ” systemdë¡œ Discord ë´‡ì„ ë°ëª¬í™”:
```bash
npm install -g pm2
cd discord-bot && pm2 start index.js --name fastfive-bot
pm2 save
```

**Step 6: ìµœì¢… ì»¤ë°‹**

```bash
git commit -m "feat: íŒ¨ìŠ¤íŠ¸íŒŒì´ë¸Œ íšŒì˜ì‹¤ ë””ìŠ¤ì½”ë“œ ì˜ˆì•½ ë´‡ êµ¬í˜„ ì™„ë£Œ"
```

---

## ì•Œë ¤ì§„ ë¦¬ìŠ¤í¬ ë° ë¯¸í•´ê²° ì‚¬í•­

1. **FastFive API request body í˜•ì‹** â€” `/mobile/spaceReservations` POSTì˜ ì •í™•í•œ í•„ë“œëŠ” Task 1ì—ì„œ ì‹¤ì œ API í˜¸ì¶œë¡œ í™•ì¸ í•„ìš”. ìœ„ ê³„íšì˜ bodyëŠ” ì¶”ì •ì¹˜.
2. **ì¿ í‚¤ ì „íŒŒ** â€” n8n HTTP Request ë…¸ë“œ ê°„ ì¿ í‚¤ ì „íŒŒê°€ ìë™ìœ¼ë¡œ ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ. Code ë…¸ë“œë¡œ ìˆ˜ë™ ì „ë‹¬ í•„ìš”.
3. **ì„¸ì…˜ ë§Œë£Œ** â€” FastFive ì„¸ì…˜ì´ ë§Œë£Œë˜ë©´ ì¬ë¡œê·¸ì¸ í•„ìš”. ë§¤ ìš”ì²­ë§ˆë‹¤ ë¡œê·¸ì¸í•˜ê±°ë‚˜, ì„¸ì…˜ ìºì‹± ë¡œì§ ì¶”ê°€.
4. **ê²°ì œ/í¬ë ˆë”§** â€” ì˜ˆì•½ ì‹œ í¬ë ˆë”§ ì°¨ê° ë˜ëŠ” ê²°ì œê°€ í•„ìš”í•œ ê²½ìš° ì¶”ê°€ API í˜¸ì¶œ í•„ìš”.
5. **Discord ë´‡ ê¶Œí•œ** â€” Message Content Intent í™œì„±í™” í•„ìš” (Discord Developer Portal).
